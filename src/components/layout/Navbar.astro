---
import { Icon } from 'astro-icon/components';
import { Image } from 'astro:assets';
import AtlasLogomark from '@/assets/atlas-logomark.svg';
---

<header
  id="main-header"
  class="fixed top-0 left-0 z-50 w-full border-b border-transparent backdrop-blur-sm transition-all duration-300"
>
  <div class="container mx-auto flex items-center justify-between px-4 py-4">
    <a href="/" class="group flex items-center gap-2">
      <div class="relative">
        <Image
          src={AtlasLogomark}
          alt="AtlasOS"
          width={100}
          height={32}
          layout="fixed"
          class="relative z-10"
          loading="eager"
          decoding="async"
          fetchpriority="high"
        />
        <div
          class="bg-primary/10 group-hover:bg-primary/20 absolute inset-0 rounded-full opacity-70 blur-lg transition-all duration-300"
        >
        </div>
      </div>
    </a>

    <nav class="hidden items-center md:flex">
      <div class="relative flex items-center space-x-8">
        <a
          href="https://docs.atlasos.net"
          class="px-4 py-2 font-medium text-white transition-colors duration-200"
          target="_blank"
          rel="noopener noreferrer">Documentation</a
        >
        <a
          href="https://github.com/orgs/Atlas-OS/discussions"
          class="px-4 py-2 font-medium text-white transition-colors duration-200"
          target="_blank"
          rel="noopener noreferrer">Discussions</a
        >
        <a
          href="https://docs.atlasos.net/general-faq/atlas-and-security/"
          class="px-4 py-2 font-medium text-white transition-colors duration-200"
          target="_blank"
          rel="noopener noreferrer">FAQ</a
        >
        <a
          href="https://ko-fi.com/atlasos"
          target="_blank"
          rel="noopener noreferrer"
          class="px-4 py-2 font-medium text-white transition-colors duration-200">Support us</a
        >
      </div>
    </nav>

    <div class="flex items-center gap-6">
      <a href="https://github.com/Atlas-OS/Atlas" target="_blank" rel="noopener noreferrer" class="text-white">
        <Icon name="tabler:brand-github" class="h-5 w-5" />
        <span class="sr-only">GitHub</span>
      </a>
      <a href="https://discord.com/invite/atlasos" target="_blank" rel="noopener noreferrer" class="text-white">
        <Icon name="tabler:brand-discord" class="h-5 w-5" />
        <span class="sr-only">Discord</span>
      </a>
      <a href="https://x.com/atlasos" target="_blank" rel="noopener noreferrer" class="text-white">
        <Icon name="tabler:brand-x" class="h-5 w-5" />
        <span class="sr-only">X (Twitter)</span>
      </a>

      <button
        type="button"
        id="mobile-menu-button"
        class="relative flex h-8 w-8 items-center justify-center text-white md:hidden"
        aria-expanded="false"
        aria-controls="mobile-menu"
        aria-label="Toggle mobile menu"
      >
        <Icon name="tabler:menu-2" class="h-5 w-5" />
        <span class="sr-only">Menu</span>
      </button>
    </div>
  </div>

  <div id="mobile-menu" class="hidden md:hidden">
    <div
      id="mobile-menu-content"
      class="space-y-4 border-t border-white/10 px-4 py-5 backdrop-blur-xl transition-all duration-300"
    >
      <a
        href="https://docs.atlasos.net"
        class="hover:bg-primary/30 block rounded-md px-4 py-3 font-medium text-white transition-colors duration-200"
        target="_blank"
        rel="noopener noreferrer">Documentation</a
      >
      <a
        href="https://github.com/orgs/Atlas-OS/discussions"
        class="hover:bg-primary/30 block rounded-md px-4 py-3 font-medium text-white transition-colors duration-200"
        target="_blank"
        rel="noopener noreferrer">Discussions</a
      >
      <a
        href="https://docs.atlasos.net/general-faq/atlas-and-security/"
        class="hover:bg-primary/30 block rounded-md px-4 py-3 font-medium text-white transition-colors duration-200"
        target="_blank"
        rel="noopener noreferrer">FAQ</a
      >
      <a
        href="https://ko-fi.com/atlasos"
        class="hover:bg-primary/30 block rounded-md px-4 py-3 font-medium text-white transition-colors duration-200"
        target="_blank"
        rel="noopener noreferrer">Support us</a
      >
    </div>
  </div>
</header>

<style>
  .bg-dotted-white\/20 {
    background-image: linear-gradient(to right, rgba(255, 255, 255, 0.2) 33%, transparent 33%);
    background-size: 4px 1px;
    background-repeat: repeat-x;
  }

  .header-scrolled {
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }

  .mobile-menu-scrolled {
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0.3) 40%, rgba(0, 0, 0, 0));
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
  }
</style>

<script>
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');

  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener('click', () => {
      const isExpanded = mobileMenu.classList.contains('hidden');
      mobileMenu.classList.toggle('hidden');
      mobileMenuButton.setAttribute('aria-expanded', (!isExpanded).toString());
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    const header = document.getElementById('main-header');
    const mobileMenuContent = document.getElementById('mobile-menu-content');

    const updateHeaderStyle = () => {
      if (!header) return;

      if (window.scrollY > 10) {
        header.classList.add('header-scrolled');
        if (mobileMenuContent) {
          mobileMenuContent.classList.add('mobile-menu-scrolled');
        }
      } else {
        header.classList.remove('header-scrolled');
        if (mobileMenuContent) {
          mobileMenuContent.classList.remove('mobile-menu-scrolled');
        }
      }
    };

    if (header) {
      updateHeaderStyle();

      window.addEventListener('scroll', updateHeaderStyle);
    }
  });
</script>
