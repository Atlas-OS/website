---
import { Icon } from 'astro-icon/components';

interface Props {
  type?: 'info' | 'warning' | 'tip' | 'danger';
  title?: string;
  dismissible?: boolean;
}

const { type = 'info', title, dismissible = false } = Astro.props;

const config = {
  info: {
    icon: 'tabler:info-circle',
    borderColor: 'border-primary/50',
    bgColor: 'bg-primary/5',
    iconColor: 'text-primary',
    glowColor: 'shadow-primary/5',
    defaultTitle: 'Info',
  },
  tip: {
    icon: 'tabler:bulb',
    borderColor: 'border-primary/50',
    bgColor: 'bg-primary/5',
    iconColor: 'text-primary',
    glowColor: 'shadow-primary/5',
    defaultTitle: 'Tip',
  },
  warning: {
    icon: 'tabler:alert-triangle',
    borderColor: 'border-yellow-500/50',
    bgColor: 'bg-yellow-500/5',
    iconColor: 'text-yellow-500',
    glowColor: 'shadow-yellow-500/5',
    defaultTitle: 'Warning',
  },
  danger: {
    icon: 'tabler:alert-circle',
    borderColor: 'border-red-500/50',
    bgColor: 'bg-red-500/5',
    iconColor: 'text-red-500',
    glowColor: 'shadow-red-500/5',
    defaultTitle: 'Important',
  },
};

const style = config[type];
const displayTitle = title || style.defaultTitle;
---

<div
  class={`callout not-prose astro-component callout-animated border-l-4 ${style.borderColor} ${style.bgColor} rounded-r-lg p-5 my-6 border border-white/10 shadow-lg ${style.glowColor}`}
  data-component="callout"
  data-type={type}
>
  <div class="flex items-start gap-3">
    <div class={`callout-icon-wrapper ${style.iconColor} flex-shrink-0`}>
      <Icon name={style.icon} class="mt-0.5 h-5 w-5" />
    </div>
    <div class="min-w-0 flex-1">
      {displayTitle && <p class={`${style.iconColor} mb-2 text-sm font-semibold`}>{displayTitle}</p>}
      <div class="callout-content text-sm leading-relaxed text-white/90">
        <slot />
      </div>
    </div>
    {
      dismissible && (
        <button
          type="button"
          class="callout-dismiss flex-shrink-0 rounded-md text-white/40 transition-opacity duration-200 hover:opacity-80 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary/50 focus-visible:ring-offset-2"
          aria-label="Dismiss"
        >
          <Icon name="tabler:x" class="h-4 w-4" />
        </button>
      )
    }
  </div>
</div>

<style is:global>
  .callout {
    margin-top: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .callout-animated {
    animation: callout-fade-in 0.4s ease-out;
  }

  @keyframes callout-fade-in {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .callout-icon-wrapper {
    animation: icon-fade-in 0.6s ease-out;
  }

  @keyframes icon-fade-in {
    0% {
      opacity: 0;
    }
    100% {
      opacity: 1;
    }
  }

  .callout-content p {
    margin-top: 0;
    margin-bottom: 0.5rem;
    color: rgb(255 255 255 / 0.9);
    font-size: 0.875rem;
    line-height: 1.5;
  }

  .callout-content p:last-child {
    margin-bottom: 0;
  }

  .callout-content strong {
    color: white;
    font-weight: 600;
  }

  .callout-content a {
    color: var(--color-primary);
    text-decoration: none;
    font-weight: 500;
    transition: opacity 0.2s ease-in-out;
  }

  .callout-content a:hover {
    opacity: 0.8;
  }

  .callout-content ul,
  .callout-content ol {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
    margin-left: 1.25rem;
    padding-left: 0;
  }

  .callout-content li {
    margin-bottom: 0.25rem;
    color: rgb(255 255 255 / 0.9);
  }

  .callout-content code {
    background-color: rgb(255 255 255 / 0.1);
    color: var(--color-primary);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
  }
</style>

<script>
  function setupCalloutDismiss() {
    const dismissButtons = document.querySelectorAll('.callout-dismiss');

    dismissButtons.forEach((button) => {
      button.addEventListener('click', () => {
        const callout = button.closest('.callout') as HTMLElement;
        if (callout) {
          callout.style.animation = 'callout-fade-out 0.3s ease-out forwards';
          setTimeout(() => {
            callout.remove();
          }, 300);
        }
      });
    });
  }

  document.addEventListener('astro:page-load', setupCalloutDismiss);
  setupCalloutDismiss();
</script>

<style>
  @keyframes callout-fade-out {
    from {
      opacity: 1;
      transform: translateY(0);
    }
    to {
      opacity: 0;
      transform: translateY(-10px);
    }
  }
</style>
